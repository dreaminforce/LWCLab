<template>
  <div class="app-shell">
    <section class="pane pane--chat">
      <header class="pane__header">
        <h1 class="title">LWC Generator</h1>
      </header>
      <div class="chat__history" role="log" aria-live="polite">
        <template if:true={hasMessages}>
          <template for:each={messages} for:item="message">
            <article key={message.id} class="chat__message" data-role={message.role}>
              <div class="chat__identity" data-role={message.role}>
                <div class="chat__avatar" data-role={message.role} aria-hidden="true">
                  <template if:true={message.isUser}>
                    <svg class="chat__avatar-icon" viewBox="0 0 24 24" aria-hidden="true">
                      <circle cx="12" cy="7.5" r="4"></circle>
                      <path d="M4 20c0-3.7 3.1-6.5 7-6.5h2c3.9 0 7 2.8 7 6.5v1H4z"></path>
                    </svg>
                  </template>
                  <template if:false={message.isUser}>
                    <svg class="chat__avatar-icon" viewBox="0 0 24 24" aria-hidden="true">
                      <rect x="4" y="6" width="16" height="12" rx="3"></rect>
                      <rect x="7" y="9" width="3" height="3" rx="1"></rect>
                      <rect x="14" y="9" width="3" height="3" rx="1"></rect>
                      <path d="M9 15h6" stroke-width="1.6" stroke-linecap="round" stroke="currentColor" fill="none"></path>
                      <path d="M9 4h6l1 2H8z"></path>
                    </svg>
                  </template>
                </div>
                <span class="chat__avatar-label">{message.label}</span>
              </div>
              <div class="chat__bubble">
                <p class="chat__text">{message.text}</p>
              </div>
            </article>
          </template>
        </template>
      </div>
      <div class="chat__composer">
        <label class="chat__label" for="prompt">Describe the component</label>
        <textarea
          id="prompt"
          class="chat__input"
          value={prompt}
          oninput={handleInput}
          placeholder="Describe the LWC you want (plain HTML only; no lightning-base-components)...">
        </textarea>
        <div class="chat__actions">
          <button
            type="button"
            class="chat__send"
            onclick={generate}
            disabled={isGenerateDisabled}>
            {buttonLabel}
          </button>
        </div>
      </div>
    </section>

    <section class="pane pane--preview">
      <div class="preview__header">
        <div>
          <h2 class="pane__title">Preview &amp; Code</h2>
          <p class="pane__subtitle">Review the generated UI or inspect the source.</p>
        </div>
        <div class="view-toggle">
          <button data-tab="preview" type="button" onclick={setTab} class={previewBtnClass}>Preview</button>
          <button data-tab="code" type="button" onclick={setTab} class={codeBtnClass}>Code</button>
        </div>
      </div>

      <div class="preview__body">
        <template if:true={generating}>
          <div class="preview__progress" role="status" aria-live="polite">
            <div class="preview__progress-bar">
              <div class="preview__progress-fill"></div>
            </div>
            <span class="preview__progress-text">Generating component...</span>
          </div>
        </template>
        <template if:true={isPreview}>
          <template if:true={hasGenerated}>
            <gen-preview></gen-preview>
          </template>
          <template if:false={hasGenerated}>
            <div class="preview__placeholder">
              Waiting for AI component...
            </div>
          </template>
        </template>

        <template if:true={isCode}>
          <template if:true={hasCode}>
            <div class="code-view">
              <div class="code-view__file">
                <div class="code-view__header">
                  <h3 class="code-view__title">preview.html</h3>
                  <button
                    type="button"
                    class="code-view__copy"
                    data-target="html"
                    onclick={copyCode}
                    title="Copy preview.html"
                    aria-label="Copy preview.html to clipboard">
                    <svg class="code-view__copy-icon" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M9 3h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
                      <path d="M7 7H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"></path>
                    </svg>
                    <span class="visually-hidden">Copy preview.html</span>
                  </button>
                </div>
                <pre class="code-view__block"><code>{codeHtml}</code></pre>
              </div>
              <div class="code-view__file">
                <div class="code-view__header">
                  <h3 class="code-view__title">preview.js</h3>
                  <button
                    type="button"
                    class="code-view__copy"
                    data-target="js"
                    onclick={copyCode}
                    title="Copy preview.js"
                    aria-label="Copy preview.js to clipboard">
                    <svg class="code-view__copy-icon" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M9 3h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
                      <path d="M7 7H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"></path>
                    </svg>
                    <span class="visually-hidden">Copy preview.js</span>
                  </button>
                </div>
                <pre class="code-view__block"><code>{codeJs}</code></pre>
              </div>
              <div class="code-view__file">
                <div class="code-view__header">
                  <h3 class="code-view__title">preview.css</h3>
                  <button
                    type="button"
                    class="code-view__copy"
                    data-target="css"
                    onclick={copyCode}
                    title="Copy preview.css"
                    aria-label="Copy preview.css to clipboard">
                    <svg class="code-view__copy-icon" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M9 3h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
                      <path d="M7 7H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"></path>
                    </svg>
                    <span class="visually-hidden">Copy preview.css</span>
                  </button>
                </div>
                <pre class="code-view__block"><code>{codeCss}</code></pre>
              </div>
            </div>
          </template>
          <template if:false={hasCode}>
            <div class="preview__placeholder">
              Code will appear here after you generate a component.
            </div>
          </template>
        </template>
      </div>
    </section>
  </div>
</template>

